5 REM INITIALIZATION
10 D$ = CHR$(4)
12 MX = 0 : MY = 0 : REM MAP ROOMS COORDINATES
14 RW = 9 : RH = 4 : REM ROOM SIZE
15 X = 23 : Y = 19 : REM INITIAL PLAYER POSITION
20 DIM PLAYER(3) : REM HOLDS X, Y, AND THE MAP CHARACTER THAT'S BEHIND THE UNIT
22 PLAYER(1) = X : PLAYER(2) = Y : PLAYER(3) = 128
24 A = 0 : REM HOLDS THE CHARACTER CODE READ BY THE READCHAR ROUTINE
26 A$ = " " : REM THE ABOVE BUT AS STRING
28 B = 0 : REM SPECIAL CHARACTERS (ALTCHAR)
30 M$ = CHR$(27) + CHR$(15) : REM TURN SPECIAL CHARACTERS ON (80COL CARD CHARS)
32 N$ = CHR$(24) + CHR$(14) : REM TURN SPECIAL CHARACTERS OFF
35 Z$ = N$ + " " + M$ : REM HOLDS THE MAP TILE PLAYER IS CURRENTLY ON

40 ? D$;"PR#3"
50 ? D$"BLOAD READCHAR"

99 REM GENERATE MAP ARRAY
100 DIM MAP(5, 5)
140 DATA 0,0,3,0,0,0,0,5,0,0,0,2,15,4,0,0,0,5,0,0,0,0,1,0,0
150 REM READ THE VALUES INTO THE ARRAY ELEMENTS
160 FOR I = 0 TO 4
170   FOR J = 0 TO 4
180     READ MAP(I,J)
190   NEXT J
200 NEXT I

359 REM DRAW ALL MAP ROOMS
360 FOR ROW = 0 TO 4
370   FOR COL = 0 TO 4
380     REM CALCULATE THE X AND Y COORDINATES OF THE TOP LEFT CORNER OF THE ROOM
390     MX = (COL) * (RW)
400     MY = (ROW) * (RH)
410     REM DRAW A ROOM AT THE CURRENT POSITION
420    GOSUB 1000
430   NEXT COL
440 NEXT ROW

450 REM GOTO 795 : REM DISPLAY DEBUG INFO RIGHT AWAY

490 FOR II=1 TO 1000: NEXT II : REM WAIT 49200,3
499 REM MAIN LOOP
500 HTAB(PLAYER(1)) : VTAB(PLAYER(2)) : REM CURRENTLY HOLDING THE PREVIOUS
501 IF PLAYER(1) = X AND PLAYER(2) = Y THEN GOTO 530 : REM JUMP IF PLAYER HAS NOT MOVED
502 HTAB(PLAYER(1)) : VTAB(PLAYER(2)) : REM CURRENTLY HOLDING THE PREVIOUS PLAYER POSITION
510 IF B = 0 THEN ? N$;A$;M$
520 IF B = 1 THEN ? A$;
530 PLAYER(1) = X : PLAYER(2) = Y : PLAYER(3) = A
540 HTAB(X) : VTAB(Y) : ? N$;"@";M$ : REM DRAW PLAYER
550 IF K > 0 AND PEEK(-16384) > 0 THEN 500
560 K = 0
570 IF PEEK(-16384) = 0 THEN 500
580 K = PEEK(-16384)
590 REM POKE-16336,0 : REM CLEARS KEYBOARD STROBE - ALWAYS AFTER READING KEYBOARD
600 VTAB(22) : ? N$;"keycode: ";K;"  ";M$; : REM DEBUG DISPLAY OF CHAR CODE KEY PRESSED

700 REM DO MOVE AND DISPLAY THE MAP CHAR AT THE PLAYER'S POSITION
710 IF K = 149 OR K = 225 OR K = 196 THEN GOTO 760
720 IF K = 136 OR K = 234 OR K = 202 THEN GOTO 770
730 IF K = 139 OR K = 247 OR K = 215 THEN GOTO 780
740 IF K = 138 OR K = 243 OR K = 211 THEN GOTO 790
745 IF K = 160 THEN GOTO 795

750 GOTO 500

760 HTAB(X) : VTAB(Y) : X = X + 1 : POKE 1147,X : POKE 1403,X : POKE 36,X : GOSUB 800 : VTAB(22) : ? N$;"  A$: ";A$;"  ";M$; : GOTO 490
770 HTAB(X) : VTAB(Y) : X = X - 1 : POKE 1147,X : POKE 1403,X : POKE 36,X : GOSUB 800 : VTAB(22) : ? N$;"  A$: ";A$;"  ";M$; : GOTO 490
780 HTAB(X) : VTAB(Y) : Y = Y - 1 : GOSUB 800 : VTAB(22) : ? N$;"  A$: ";A$;"  ";M$; : GOTO 490
790 HTAB(X) : VTAB(Y) : Y = Y + 1 : GOSUB 800 : VTAB(22) : ? N$;"  A$: ";A$;"  ";M$; : GOTO 490
795 GOSUB 950 : VTAB(22) : ? N$;"  A$: ";A$;"  ";M$; : GOTO 490
799 REM SCRN(X,Y);"  ";

800 REM PEEK(36) AND POS(0) are not working in 80 col, SO BELOW WE ACCESS DIFFERENT ADDRESSES TO BE SURE
810 P1 = PEEK (36)
820 IF P1 = 0 THEN P1 = PEEK (1403)
830 IF P1 = 0 THEN P1 = PEEK (1147)
840 P2 = PEEK (37)
850 POKE 1403,P1-1 : POKE 1147,P1-1 : POKE 36,P1-1 : REM MAKE SURE WE HAVE THE CORRECT X POSITION
930 CALL 32256: REM CALL THE GETCHAR ROUTINE
940 A = PEEK(6) : A$ = CHR$(A) : REM PLAYER(3) = A
945 REM B = PEEK(49167)
950 HTAB(2) : VTAB(23) : ? N$;"cursor: ";P1;"x";P2;"    PLAYER symbol: ";A;" (";M$;A$;N$;")"
970 HTAB(2) : VTAB(24) :  ? N$;"symbol: ";A;" ";M$;A$;N$;"  ";B;" ";M$; : REM DEBUG DISPLAY OF CHAR CODE

980 RETURN

990 ? CHR$(14) : END

1000 REM DRAW A TILE
1005 ? CHR$(15)
1010 HTAB(MX+1) : VTAB(MY+1)

1012 IF MY < 4 THEN GOTO 1016
1014 ? N$;" ";M$;"\\\\\\\\\\\\\\";N$;" ";M$
1015 GOTO 1020
1016 ? N$;" _______ ";M$ : REM DRAW TOP EDGE

1020 M = MAP(ROW, COL)
1025 IF M <> 0 THEN HTAB(MX+1) : VTAB(MY+2) : ? "Z_";N$;"     ";M$;"Z_"
1030 IF M <> 0 THEN HTAB(MX+1) : VTAB(MY+3) : ? "Z_";N$;"     ";M$;"Z_"
1040 IF M <> 0 THEN HTAB(MX+1) : VTAB(MY+4) : ? "Z_";N$;"     ";M$;"Z_"

1050 IF M = 0 THEN HTAB(MX+1) : VTAB(MY+2) : ? "ZVWVWVWV_"
1060 IF M = 0 THEN HTAB(MX+1) : VTAB(MY+3) : ? "ZVWVWVWV_"
1070 IF M = 0 THEN HTAB(MX+1) : VTAB(MY+4) : ? "ZVWVWVWV_"

1090 IF M = 1 OR M = 5 OR M = 7 OR M = 8 OR M = 11 OR M > 12 THEN HTAB(MX+4) : VTAB(MY+1) : ? " ^ " : REM DRAW DOOR


1145 IF MY < 15 THEN RETURN
1150 HTAB(MX+1) : VTAB(MY+5) : ? N$;" ";M$;"LLLLLLL";N$;" ";M$
1160 RETURN