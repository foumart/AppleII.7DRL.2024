100 REM INITIALIZE MAZE DIMENSIONS
200 DIM AVAILABLE(4) : AVAILABLE(1) = 0 : AVAILABLE(2) = 0 : AVAILABLE(3) = 0 : AVAILABLE(4) = 0
250 SIZE = 4
300 DIM MAP(SIZE,SIZE)
320 DIM VISIBLES(SIZE,SIZE)
340 DIM SX(SIZE*SIZE)
360 DIM SY(SIZE*SIZE)

380 STACK = 0

400 FOR Y = 1 TO SIZE
500    FOR X = 1 TO SIZE
600       MAP(X, Y) = 0
700       VISIBLES(X, Y) = 0
800    NEXT X
900 NEXT Y

910 HOME : PRINT "HIT" : PRINT "ANY" : PRINT "KEY"
920 FOR O = 768 TO 782 : READ P
930 POKE O,P : NEXT O : CALL 768 : Q = RND(-1*(PEEK(78)+256*PEEK(79)))
940 DATA 230,78,208,2,230,79,44,0,192,16,245,44,16,192,96

1000 REM GENERATE MAZE
1050 GOSUB 1200
1100 GOSUB 2000
1125 PRINT "REPEAT"; : IF STACK > 0 THEN GOSUB 2300
1150 PRINT "COMPLETE"
1190 END





1200 REM DEBUG PRINT MAZE
1210 POKE 32,0 : REM SCROLL X
1220 POKE 33,39 : REM SCROLL WIDTH
1230 POKE 34,6 : REM SCROLL Y
1240 POKE 35,24 : REM SCROLL HEIGHT
1250 FOR YY = 1 TO SIZE
1260    FOR XX = 1 TO SIZE
1270       HTAB(XX) : VTAB(YY) : O = 1
1272       FOR ZZ = 1 TO STACK
1274         IF XX = SX(ZZ) AND YY = SY(ZZ) THEN O = 0
1276       NEXT ZZ
1277       IF MAP(XX, YY) = 0 OR O > 0 THEN INVERSE : PRINT MAP(XX, YY) : NORMAL : GOTO 1280
1278       PRINT MAP(XX, YY)
1280    NEXT XX
1290 NEXT YY
1300 FOR YY = 1 TO SIZE
1310    FOR XX = 1 TO SIZE
1320       HTAB(XX+6) : VTAB(YY)
1322       IF X = XX AND Y = YY THEN INVERSE : PRINT VISIBLES(XX, YY); : NORMAL : GOTO 1330
1325       PRINT VISIBLES(XX, YY);
1330    NEXT XX
1340 NEXT YY
1350 REM POKE 32,0 : REM SCROLL X
1360 REM POKE 33,40 : REM SCROLL WIDTH
1370 REM POKE 34,0 : REM SCROLL Y
1380 REM POKE 35,24 : REM SCROLL HEIGHT
1390 HTAB(13) : VTAB(1)
1394 IF STACK < 10 THEN PRINT "S:";STACK; : CALL -868 : GOTO 1400
1396 PRINT ":";STACK; : CALL -868
1400 FOR YY = 2 TO 5
1404   HTAB(12) : VTAB(YY) : CALL -868
1408 NEXT YY
1450 FOR YY = 1 TO STACK
1460   HTAB(13+INT(YY/5)*4) : VTAB(YY - INT(YY/5)*5 + 1) : PRINT SX(YY);"*";SY(YY);"  "
1480 NEXT YY
1490 RETURN





1500 REM ADD A CELL TO STACK
1505 HTAB(34) : VTAB(1) : PRINT "XY:";XX;"*";YY;
1508 ZZ = 0
1510 FOR I = 1 TO STACK
1520   IF SX(I) = XX AND SY(I) = YY THEN ZZ = 1 : REM VTAB(24): PRINT "SKIPPED ";STACK;" AT ";XX;"*";YY
1530 NEXT I
1540 IF ZZ = 1 THEN VTAB(24): PRINT AA$;" SKIP " : GOTO 1650
1600 STACK = STACK + 1 : VTAB(24): PRINT AA$;" ADDED ";STACK;" AT ";XX;"*";YY
1610 SX(STACK) = XX
1620 SY(STACK) = YY
1650 RETURN





2000 REM DEPTH-FIRST SEARCH ALGORITHM FOR GENERATING A RANDOMIZED INTERCONNECTED ROOM MAP
2100 X = INT(RND(1) * SIZE) + 1: Y = 1 : REM INITIAL ROOM PICK
2150 REM MARK CURRENT CELL AS VISITED
2200 VISIBLES(X,Y) = 1 : MAP(X,Y) = 1
2250 XX = X : YY = Y : AA$ = "C" : GOSUB 1500

2300 REM MARK CURRENT CELL AS VISITED
2400 GOSUB 1200
2450 CALL 768

2500 REM ADD CURRENT CELL TO STACK
2550 REM XX = X : YY = Y : GOSUB 1500

2900 REM CHECK FOR UNVISITED NEIGHBOURS
2950 REM            UP                 RIGHT              DOWN               LEFT
3000 NEIGHBRS = 0 : AVAILABLE(1) = 0 : AVAILABLE(2) = 0 : AVAILABLE(3) = 0 : AVAILABLE(4) = 0
3100 FOR DIR = 1 TO 4
3200   IF DIR = 1 AND Y > 1 THEN GOTO 3800
3300   IF DIR = 2 AND X < SIZE THEN GOTO 3820
3400   IF DIR = 3 AND Y < SIZE THEN GOTO 3840
3500   IF DIR = 4 AND X > 1 THEN GOTO 3860
3600 NEXT DIR
3700 GOTO 4000


3800 IF VISIBLES(X, Y - 1) = 0 THEN NEIGHBRS = NEIGHBRS + 1: AVAILABLE(NEIGHBRS) = 1
3810 GOTO 3600

3820 IF VISIBLES(X + 1, Y) = 0 THEN NEIGHBRS = NEIGHBRS + 1: AVAILABLE(NEIGHBRS) = 2
3830 GOTO 3600

3840 IF VISIBLES(X, Y + 1) = 0 THEN NEIGHBRS = NEIGHBRS + 1: AVAILABLE(NEIGHBRS) = 3
3850 GOTO 3600

3860 IF VISIBLES(X - 1, Y) = 0 THEN NEIGHBRS = NEIGHBRS + 1: AVAILABLE(NEIGHBRS) = 4
3870 GOTO 3600


4000 REM PRINT NEIGHBRS : REM WE HAVE CHECKED THE NEIGHBOURS
4100 IF NEIGHBRS = 0 THEN GOTO 6000

4200 FOR I = 1 TO NEIGHBRS
4210 ON AVAILABLE(I) GOTO 4300, 4400, 4500, 4600

4300 IF RND(1)*4 > 2 THEN Y = Y - 1 : GOTO 5000 : REM UP
4400 IF RND(1)*3 > 1 THEN X = X + 1 : GOTO 5200 : REM RIGHT
4500 IF RND(1)*3 > 1 THEN Y = Y + 1 : GOTO 5400 : REM DOWN
4600 IF RND(1)*3 > 1 THEN X = X - 1 : GOTO 5600 : REM LEFT
4650 VTAB(24):HTAB(1):PRINT "TRY AGAIN"
4700 GOTO 4200

5000 AA$ = "U" : REM REM UP
5010 IF MAP(X,Y) = 0 THEN MAP(X,Y) = 1
5050 VISIBLES(X,Y) = 1
5060 IF MAP(X,Y-1) = 1 THEN MAP(X,Y-1) = 2 : GOTO 5150
5070 IF MAP(X,Y-1) = 3 THEN MAP(X,Y-1) = 4
5140 REM TODO : CLOSED DOORS
5150 XX = X : YY = Y : GOSUB 1500
5190 GOTO 6400

5200 AA$ = "R" : REM RIGHT
5210 IF MAP(X,Y) = 0 THEN MAP(X,Y) = 3 : GOTO 5250
5220 IF MAP(X,Y) = 2 THEN MAP(X,Y) = 4
5250 VISIBLES(X,Y) = 1
5260 REM IF MAP(X-1,Y) = 0 THEN MAP(X-1,Y) = 1
5350 XX = X : YY = Y : GOSUB 1500
5390 GOTO 6400

5400 AA$ = "D" : REM DOWN
5405 IF MAP(X,Y) = 0 THEN MAP(X,Y) = 2 : GOTO 5450
5410 IF MAP(X,Y) = 3 THEN MAP(X,Y) = 4
5450 VISIBLES(X,Y) = 1
5460 REM IF MAP(X,Y-1) = 0 THEN MAP(X,Y-1) = 1
5470 XX = X : YY = Y : GOSUB 1500
5590 GOTO 6400

5600 AA$ = "L" : REM LEFT
5610 IF MAP(X,Y) = 0 THEN MAP(X,Y) = 1
5650 VISIBLES(X,Y) = 1
5660 IF MAP(X+1,Y) = 1 THEN MAP(X+1,Y) = 3 : GOTO 5750
5670 IF MAP(X+1,Y) = 2 THEN MAP(X+1,Y) = 4
5750 XX = X : YY = Y : GOSUB 1500
5790 GOTO 6400


6000 REM IF NO UNVISITED NEIGHBRS - BACKTRACK, OR
6100 REM IF
6200 SX(STACK) = 0 : SY(STACK) = 0 : STACK = STACK - 1 : VTAB(24): PRINT "REMOVED ";STACK;" AT ";X;"*";Y; " GETTING ";SX(STACK);"*";SY(STACK)

6400 REM
6440 REM VTAB(24): PRINT "GET STACK: ";STACK;" AT ";SX(STACK);"*";SY(STACK)
6450 IF SX(STACK) > 0 THEN X = SX(STACK) : Y = SY(STACK) : GOTO 2300
6500 REM ? STACK, SX(STACK), SY(STACK)

9900 RETURN